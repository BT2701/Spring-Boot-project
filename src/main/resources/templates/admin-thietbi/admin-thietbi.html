<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link rel="stylesheet" href="../css/thietbi.css" />
  <style></style>
</head>

<body>
  <div id="header"></div>
  <header class="mb-4">
    <div class="container d-flex flex-wrap justify-content-center">
      <!-- Header -->
      <h1 class="mt-4 mb-4 text-center fw-bold">Quản lý thiết bị</h1>
      <!-- Ô tìm kiếm và bộ lọc -->
      <div class="d-flex w-100 me-3" role="search">
        <input id="searchInput" type="search" class="form-control fs-5 w-50" placeholder="Search..."
          aria-label="Search" />
        <select id="searchOption" class="form-select fs-5 w-25" aria-label="Default select example">
          <option value="all" selected>All</option>
          <option value="id">ID</option>
          <option value="tenTB">Tên thiết bị</option>
          <option value="moTaTB">Mô tả thiết bị</option>
        </select>
      </div>

    </div>
  </header>

  <div class="main">
    <!-- Table -->
    <div class="container-table100">
      <div class="wrap-table100">
        <div class="table100 ver1 m-b-110">
          <div class="table100-head">
            <table>
              <thead>
                <tr class="row100 head">
                  <th class="cell100 column1">ID</th>
                  <th class="cell100 column2">Tên thiết bị</th>
                  <th class="cell100 column3">Mô tả thiết bị</th>
                  <th class="cell100 column4">Thao tác</th>
                </tr>
              </thead>
            </table>
          </div>
          <div class="table100-body js-pscroll">
            <table>
              <tbody>
                <tr class="row100 body table-row" th:each="tb: ${tbList}">
                  <td class="cell100 column1" th:utext="${tb.maTB}"></td>
                  <td class="cell100 column2" th:utext="${tb.tenTB}"></td>
                  <td class="cell100 column3" th:utext="${tb.moTaTB}"></td>
                  <td class="cell100 column4">
                    <button class="btn btn-primary rounded-pill px-3" type="button"
                      onclick="toggleClassUpdateItem(this)">
                      Sửa
                      <svg width="17px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path fill="#ffffff"
                          d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z" />
                      </svg>
                    </button>
                    <button class="btn btn-danger rounded-pill px-3" type="button"
                      onclick="toggleClassDeleteItem(this)">
                      Xóa
                      <svg width="17px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                        <path fill="#ffffff"
                          d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z" />
                      </svg>
                    </button>
                    <button class="btn btn-danger rounded-pill px-3" type="button">
                      <i class="fa-solid fa-list"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Button -->
    <div class="d-flex gap-2 justify-content-end py-2">
      <button class="btn btn-success rounded-pill px-3" type="button" onclick="toggleClassAddItem()">
        Thêm
        <svg width="17px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
          <path fill="#ffffff"
            d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z" />
        </svg>
      </button>

      <button class="btn btn-danger rounded-pill px-3" type="button" onclick="toggleClassDeleteItems()">
        Xóa nhiều
        <svg width="17px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
          <path fill="#ffffff"
            d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z" />
        </svg>
      </button>
      <button class="btn btn-success rounded-pill px-3" type="button" onclick="toggleClassChooseFile()">
        Nhập file excel
        <svg width="17px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
          <path fill="#ffffff"
            d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM155.7 250.2L192 302.1l36.3-51.9c7.6-10.9 22.6-13.5 33.4-5.9s13.5 22.6 5.9 33.4L221.3 344l46.4 66.2c7.6 10.9 5 25.8-5.9 33.4s-25.8 5-33.4-5.9L192 385.8l-36.3 51.9c-7.6 10.9-22.6 13.5-33.4 5.9s-13.5-22.6-5.9-33.4L162.7 344l-46.4-66.2c-7.6-10.9-5-25.8 5.9-33.4s25.8-5 33.4 5.9z" />
        </svg>
      </button>
      <a class="btn btn-secondary rounded-pill px-3" type="button" href="/thiet-bi-admin">
        Refresh
        <svg width="17px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <path fill="#ffffff"
            d="M105.1 202.6c7.7-21.8 20.2-42.3 37.8-59.8c62.5-62.5 163.8-62.5 226.3 0L386.3 160H352c-17.7 0-32 14.3-32 32s14.3 32 32 32H463.5c0 0 0 0 0 0h.4c17.7 0 32-14.3 32-32V80c0-17.7-14.3-32-32-32s-32 14.3-32 32v35.2L414.4 97.6c-87.5-87.5-229.3-87.5-316.8 0C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5zM39 289.3c-5 1.5-9.8 4.2-13.7 8.2c-4 4-6.7 8.8-8.1 14c-.3 1.2-.6 2.5-.8 3.8c-.3 1.7-.4 3.4-.4 5.1V432c0 17.7 14.3 32 32 32s32-14.3 32-32V396.9l17.6 17.5 0 0c87.5 87.4 229.3 87.4 316.7 0c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.5 62.5-163.8 62.5-226.3 0l-.1-.1L125.6 352H160c17.7 0 32-14.3 32-32s-14.3-32-32-32H48.4c-1.6 0-3.2 .1-4.8 .3s-3.1 .5-4.6 1z" />
        </svg>
      </a>
    </div>
  </div>
  <!-- Modal thêm thiết bị -->
  <div class="ps-ab modal modal-sheet d-block bg-body-secondary p-4 py-md-5 d-none" tabindex="-1" role="dialog"
    id="addItem">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <h1 class="fw-bold mb-0 fs-2">Thông tin thiết bị</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            onclick="toggleClassAddItemRemove()"></button>
        </div>
        <div class="modal-body p-5 pt-0">
          <div class="form-floating mb-3">
            <input type="text" class="form-control rounded-3" id="idTB-modal-add" placeholder="" disabled />
            <label>ID</label>
          </div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control rounded-3" id="tenTB-modal-add" placeholder=""
              oninput="getNewestId()" />
            <label>Tên thiết bị</label>
          </div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control rounded-3" id="moTaTB-modal-add" placeholder="" />
            <label >Mô tả thiết bị</label>
          </div>
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-primary" type="submit" onclick="addNewTB()">
            Xác nhận
          </button>
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-danger" type="submit" onclick="toggleClassAddItemRemove()">
            Hủy
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal sửa thiết bị  -->
  <div class="ps-ab modal modal-sheet d-block bg-body-secondary p-4 py-md-5 d-none" tabindex="-1" role="dialog"
    id="updateItem">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <h1 class="fw-bold mb-0 fs-2">Sửa thiết bị</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            onclick="toggleClassUpdateItemRemove()"></button>
        </div>

        <div class="modal-body p-5 pt-0">
          <div class="form-floating mb-3">
            <input type="text" class="form-control rounded-3" id="idTB-modal-update" placeholder="" disabled />
            <label>ID</label>
          </div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control rounded-3" id="tenTB-modal-update" placeholder="" />
            <label>Tên thiết bị</label>
          </div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control rounded-3" id="moTaTB-modal-update" placeholder="" />
            <label>Mô tả thiết bị</label>
          </div>
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-primary" type="submit" onclick="updateThietBi()">
            Xác nhận
          </button>
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-danger" type="submit"
            onclick="toggleClassUpdateItemRemove()">
            Hủy
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal xóa thiết bị -->
  <div class="ps-ab modal modal-sheet d-block bg-body-secondary p-4 py-md-5 d-none" tabindex="-1" role="dialog"
    id="deleteItem">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <h1 class="fw-bold mb-0 fs-2">Xác nhận xóa</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            onclick="toggleClassDeleteItemRemove()"></button>
        </div>

        <div class="modal-body p-5 pt-0">
          <span class="text-body-secondary" id="span-modal-delete">Bạn có chắc chắn muốn xóa không</span>
          <a class="w-100 mt-4 mb-2 btn btn-lg rounded-3 btn-primary" href="" id="href-modal-delete">
            Xác nhận
          </a>
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-danger" type="submit"
            onclick="toggleClassDeleteItemRemove()">
            Hủy
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal cảnh báo xóa thiết bị -->
  <div class="ps-ab modal modal-sheet d-block bg-body-secondary p-4 py-md-5 d-none" tabindex="-1" role="dialog"
    id="warningDelete">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <h1 class="fw-bold mb-0 fs-2">Xác nhận xóa</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            onclick="toggleClassWarningDeleteRemove()"></button>
        </div>

        <div class="modal-body p-5 pt-0">
          <span class="text-body-secondary" id="span-modal-warningDelete">Bạn có chắc chắn muốn xóa không</span>
          <button class="w-100 mt-4 mb-2 btn btn-lg rounded-3 btn-primary"  onclick="deleteListThietBi()">
            Xác nhận
          </button>
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-danger" type="submit"
            onclick="toggleClassWarningDeleteRemove()">
            Hủy
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal xóa nhiều thiết bị -->
  <div class="ps-ab modal modal-sheet d-block bg-body-secondary p-4 py-md-5 d-none" tabindex="-1" role="dialog"
    id="deleteItems">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <h1 class="fw-bold mb-0 fs-2">Xóa nhiều thiết bị</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            onclick="toggleClassDeleteItemsRemove()"></button>
        </div>

        <div class="modal-body p-5 pt-0">
          <div class="form-floating mb-3">
            <select class="form-select" aria-label="Default select example" id="idOption-modal-deleteList">
              <option selected value="1">1-Micro</option>
              <option value="2">2-Máy chiếu</option>
              <option value="3">3-Máy ảnh</option>
              <option value="4">4-Cassette</option>
              <option value="5">5-Tivi</option>
              <option value="6">6-Quạt đứng</option>
            </select>
            <label>Loại thiết bị</label>
          </div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control rounded-3" id="tenTB-modal-deleteList" placeholder="" />
            <label >Tên thiết bị</label>
          </div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control rounded-3" id="moTaTB-modal-deleteList" placeholder="" />
            <label >Mô tả thiết bị</label>
          </div>
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-primary" type="submit" onclick="toggleClassWarningDelete()">
            Xác nhận
          </button>
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-danger" type="submit"
            onclick="toggleClassDeleteItemsRemove()">
            Hủy
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal thông báo -->
  <div class="ps-ab modal modal-sheet d-block bg-body-secondary p-4 py-md-5 d-none" tabindex="-1" role="dialog"
    id="modalNoti">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header p-5 pb-4 border-bottom-0 justify-content-center">
          <h1 class="fw-bold mb-0 fs-2">Thông báo</h1>
        </div>

        <div class="modal-body p-5 pt-0">
          <span class="text-body-secondary" id="message-modal-noti"></span>
          <a class="w-100 mb-2 mt-4 btn btn-lg rounded-3 btn-primary" type="submit" onclick="toggleClassNotiRemove()"
            href="/thiet-bi-admin">
            Xác nhận
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal chọn file excel -->
  <div class="ps-ab modal modal-sheet d-block bg-body-secondary p-4 py-md-5 d-none" tabindex="-1" role="dialog"
    id="chooseFileModal">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header p-5 pb-4 border-bottom-0 justify-content-center">
          <h1 class="fw-bold mb-0 fs-2">Thêm thiết bị bằng file Excel</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            onclick="toggleClassChooseFileRemove()"></button>
        </div>

        <div class="modal-body p-5 pt-0">
          <input type="file" class="form-control mb-3" id="filechooser" accept=".xls, .xlsx">
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-primary" type="submit" onclick="toggleClassWarningDelete()">
            Xác nhận
          </button>
          <button class="w-100 mb-2 btn btn-lg rounded-3 btn-danger" type="submit"
            onclick="toggleClassChooseFileRemove()">
            Hủy
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Tải header và footer bằng AJAX
      fetch("./admin-header")
              .then(response => response.text())
              .then(html => {
                document.getElementById("header").innerHTML = html;
              });


    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script>
    function toggleClassAddItem() {
      document.getElementById("idTB-modal-add").value = "";
      document.getElementById("tenTB-modal-add").value = "";
      document.getElementById("moTaTB-modal-add").value = "";

      var element = document.getElementById("addItem");
      element.classList.toggle("d-none");
    }

    function toggleClassAddItemRemove() {
      var element = document.getElementById("addItem");
      element.classList.toggle("d-none");
    }

    function toggleClassDeleteItems() {
      document.getElementById("idOption-modal-deleteList").value = 1;
      document.getElementById("tenTB-modal-deleteList").value = "";
      document.getElementById("moTaTB-modal-deleteList").value = "";
      var element = document.getElementById("deleteItems");
      element.classList.toggle("d-none");
    }

    function toggleClassDeleteItemsRemove() {
      var element = document.getElementById("deleteItems");
      element.classList.toggle("d-none");
    }

    function toggleClassDeleteItem(btn) {
      var row = btn.closest("tr");
      var maTB = row.querySelector(".column1").innerText; // Lấy giá trị của cột 1

      // Gán giá trị cho các span
      document.getElementById("span-modal-delete").innerText = "Bạn có chắc chắn muốn xóa thiết bị có ID " + maTB + " không?";

      document.getElementById("href-modal-delete").href = `/thiet-bi-admin/delete/${maTB}`;

      // Hiển thị modal delete
      var element = document.getElementById("deleteItem");
      element.classList.toggle("d-none");
    }

    function toggleClassDeleteItemRemove() {
      var element = document.getElementById("deleteItem");
      element.classList.toggle("d-none");
    }

    function toggleClassUpdateItem(btn) {
      var row = btn.closest("tr");
      var maTB = row.querySelector(".column1").innerText; // Lấy giá trị của cột 1
      var tenTB = row.querySelector(".column2").innerText; // Lấy giá trị của cột 2
      var moTaTB = row.querySelector(".column3").innerText; // Lấy giá trị của cột 3

      // Gán giá trị cho các input
      document.getElementById("idTB-modal-update").value = maTB;
      document.getElementById("tenTB-modal-update").value = tenTB;
      document.getElementById("moTaTB-modal-update").value = moTaTB;

      // Hiển thị modal update
      var element = document.getElementById("updateItem");
      element.classList.toggle("d-none");
    }

    function toggleClassUpdateItemRemove() {
      var element = document.getElementById("updateItem");
      element.classList.toggle("d-none");

    }

    function toggleClassNotiRemove() {
      var element = document.getElementById("modalNoti");
      element.classList.toggle("d-none");
    }

    function toggleClassWarningDelete() {
      const idOp = document.getElementById("idOption-modal-deleteList").value;
      const tenTB = document.getElementById("tenTB-modal-deleteList").value;
      const moTaTB = document.getElementById("moTaTB-modal-deleteList").value;

      // Định nghĩa một đối tượng ánh xạ giữa giá trị option và tên tương ứng của loại thiết bị
    const tenTBMap = {
        "1": "Micro",
        "2": "Máy chiếu",
        "3": "Máy ảnh",
        "4": "Cassette",
        "5": "Tivi",
        "6": "Quạt đứng"
    };

    // Lấy tên tương ứng của loại thiết bị dựa trên giá trị option đã chọn
    const tenTBFromOption = tenTBMap[idOp];

    let message = "Bạn có chắc chắn muốn xóa các thiết bị ";

    // Thêm tên thiết bị vào câu thông báo
    if (tenTBFromOption) {
        message +=  tenTBFromOption + " không?";
    }

      document.getElementById("span-modal-warningDelete").innerText = message;

      var element = document.getElementById("deleteItems");
      element.classList.toggle("d-none");

      var element1 = document.getElementById("warningDelete");
      element1.classList.toggle("d-none");
    }

    function toggleClassWarningDeleteRemove() {
      var element = document.getElementById("warningDelete");
      element.classList.toggle("d-none");

      var element1 = document.getElementById("deleteItems");
      element1.classList.toggle("d-none");
    }

    function toggleClassChooseFile() {
      var element = document.getElementById("chooseFileModal");
      element.classList.toggle("d-none");
    }

    function toggleClassChooseFileRemove() {
      var element = document.getElementById("chooseFileModal");
      element.classList.toggle("d-none");
    }
  </script>

  <script>
    async function getNewestId() {
      const tenTB = document.getElementById("tenTB-modal-add").value.trim(); // Lấy giá trị của trường "Tên thiết bị" và loại bỏ khoảng trắng thừa
      const words = tenTB.split(/\s+/); // Tách từ trong tên thiết bị thành mảng các từ

      let id = 0;

      switch (words[0]) {
        case "Micro":
          id = await getNewestIdByTenTB("Micro");
          if (id == 1) id = 100001;
          break;
        case "Máy":
          if (words.length >= 2) {
            if (words[1] === "chiếu") {
              id = await getNewestIdByTenTB("Máy chiếu");
              if (id == 1) id = 200001;
            } else if (words[1] === "ảnh") {
              id = await getNewestIdByTenTB("Máy ảnh");
              if (id == 1) id = 300001;
            }
          }
          break;
        case "Cassette":
          id = await getNewestIdByTenTB("Cassette");
          if (id == 1) id = 400001;
          break;
        case "Tivi":
          id = await getNewestIdByTenTB("Tivi");
          if (id == 1) id = 500001;
          break;
        case "Quạt":
          if (words.length >= 2 && words[1] === "đứng") {
            id = await getNewestIdByTenTB("Quạt đứng");
            if (id == 1) id = 600001;
          }
          break;
      }

      if (id !== 0) {
        document.getElementById("idTB-modal-add").value = id;
      } else {
        document.getElementById("idTB-modal-add").value = "";
      }
    }

    async function getNewestIdByTenTB(tenTB) {
      const response = await fetch(`/thiet-bi-admin/newestId/${tenTB}`);
      const data = await response.json();
      return data.id;
    }
  </script>

  <script>
    async function addNewTB() {
      const idTB = document.getElementById("idTB-modal-add").value;
      if (idTB === "") {
        // Trường idTB-modal-add đang trống
        alert("Bạn nhập sai định dạng tên! Bạn phải nhập tên có chữ cái đầu: Micro, Máy chiếu, Máy ảnh, Cassette, Tivi, Quạt đứng");

      } else {
        // Trường idTB-modal-add không trống
        const tenTB = document.getElementById("tenTB-modal-add").value;
        const moTaTB = document.getElementById("moTaTB-modal-add").value;

        const data = { idTB, tenTB, moTaTB };

        const response = await fetch(`/thiet-bi-admin/add`, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: new URLSearchParams(data)
        });
        const rs = await response.json();

        var element = document.getElementById("addItem");
        element.classList.toggle("d-none");

        var element = document.getElementById("modalNoti");
        element.classList.toggle("d-none");

        document.getElementById("message-modal-noti").innerText = rs.message;
      }
    }
  </script>

  <script>
    async function updateThietBi() {
      // Trường idTB-modal-add không trống
      const idTB = document.getElementById("idTB-modal-update").value;
      const tenTB = document.getElementById("tenTB-modal-update").value;
      const moTaTB = document.getElementById("moTaTB-modal-update").value;

      const data = { idTB, tenTB, moTaTB };

      const response = await fetch(`/thiet-bi-admin/update`, {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: new URLSearchParams(data)
      });
      const rs = await response.json();

      var element = document.getElementById("updateItem");
      element.classList.toggle("d-none");

      var element = document.getElementById("modalNoti");
      element.classList.toggle("d-none");

      document.getElementById("message-modal-noti").innerText = rs.message;
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const searchInput = document.getElementById('searchInput');
      const searchOption = document.getElementById('searchOption');

      // Bắt sự kiện khi người dùng thay đổi giá trị của ô input tìm kiếm
      searchInput.addEventListener('input', function () {
        const searchText = searchInput.value.trim().toLowerCase();
        const selectedOption = searchOption.value;

        // Gọi hàm để lọc thông tin bảng
        filterTable(searchText, selectedOption);
      });

      // Bắt sự kiện khi người dùng thay đổi giá trị của dropdown menu
      searchOption.addEventListener('change', function () {
        const searchText = searchInput.value.trim().toLowerCase();
        const selectedOption = searchOption.value;

        // Gọi hàm để lọc thông tin bảng
        filterTable(searchText, selectedOption);
      });

      // Hàm để lọc thông tin bảng dựa trên từ khóa tìm kiếm và tùy chọn đã chọn
      function filterTable(searchText, selectedOption) {
        const tableRows = document.querySelectorAll('.table-row');

        tableRows.forEach(function (row) {
          const rowData1 = row.querySelector('.column1').textContent.trim().toLowerCase();
          const rowData2 = row.querySelector('.column2').textContent.trim().toLowerCase();
          const rowData3 = row.querySelector('.column3').textContent.trim().toLowerCase();

          if (
            (selectedOption == 'all' && (rowData1.includes(searchText) || rowData2.includes(searchText) || rowData3.includes(searchText))) ||
            (selectedOption === 'id' && rowData1.includes(searchText)) ||
            (selectedOption === 'tenTB' && rowData2.includes(searchText)) ||
            (selectedOption === 'moTaTB' && rowData3.includes(searchText))
          ) {
            row.style.display = ''; // Hiển thị hàng nếu dữ liệu khớp với từ khóa tìm kiếm và tùy chọn đã chọn
          } else {
            row.style.display = 'none'; // Ẩn hàng nếu không khớp
          }
        });
      }
    });
  </script>

  <script>
    async function deleteListThietBi() {

      const idOp = document.getElementById("idOption-modal-deleteList").value;
      const tenTB = document.getElementById("tenTB-modal-deleteList").value;
      const moTaTB = document.getElementById("moTaTB-modal-deleteList").value;

      const data = { idOp, tenTB, moTaTB };

      const response = await fetch(`/thiet-bi-admin/deleteList`, {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: new URLSearchParams(data)
      });

      const rs = await response.json();

      var element = document.getElementById("deleteItems");
      element.classList.toggle("d-none");

      var element = document.getElementById("modalNoti");
      element.classList.toggle("d-none");

      let message = "";

      if(rs.successIds.length == 0) {
        if(rs.failureIds.length != 0) {
          message += "Xóa thât bại " + rs.failureIds.length + " thiết bị có ID: " + rs.failureIds.join(", ");
        } else message += "Không có thiết bị nào thỏa mãn điều kiện";
      } else {
         message += "Xóa thành công " + rs.successIds.length + " thiết bị có ID: " + rs.successIds.join(", ");
        if(rs.failureIds.length != 0) {
          message += "\nXóa thất bại " + rs.failureIds.length + " thiết bị có ID: " + rs.failureIds.join(", ");
        }
      } 

      document.getElementById("message-modal-noti").innerText = message;

    }
  </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.0/xlsx.full.min.js"></script>
  <script>

    // Function to handle file change event
const handleFileChange = (event) => {
    const file = event.target.files[0];
    const reader = new FileReader();

    // Define onload event handler
    reader.onload = (e) => {
        // Get binary data from the loaded file
        const data = new Uint8Array(e.target.result);

        // Convert binary data to workbook object
        const workbook = XLSX.read(data, { type: 'array' });

        // Get the first sheet of the workbook
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];

        // Convert sheet data to JSON format
        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        // Process the JSON data (if needed)
        const list = [];

        // Skip header row
        jsonData.shift();

        // Iterate through rows
        jsonData.forEach((row) => {
            const id = parseInt(row[0]);
            const value2 = row[1];
            const value3 = row[2];

            const thietBiModel = { id, value2, value3 };
            list.push(thietBiModel);
        });

        // Now you have the data in the 'list' array
        console.log(list);
    };

    // Read the file as binary string
    reader.readAsArrayBuffer(file);
};

// Add event listener to file input element
const fileInput = document.getElementById('filechooser');
fileInput.addEventListener('change', handleFileChange);

  </script>
  <script src="https://kit.fontawesome.com/56362bb265.js" crossorigin="anonymous"></script>
</body>

</html>